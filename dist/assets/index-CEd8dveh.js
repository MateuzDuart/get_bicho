(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function o(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=o(s);fetch(s.href,r)}})();function y(e,t=!1){return window.__TAURI_INTERNALS__.transformCallback(e,t)}async function w(e,t={},o){return window.__TAURI_INTERNALS__.invoke(e,t,o)}async function b(e={}){return typeof e=="object"&&Object.freeze(e),await w("plugin:dialog|save",{options:e})}var _;(function(e){e.WINDOW_RESIZED="tauri://resize",e.WINDOW_MOVED="tauri://move",e.WINDOW_CLOSE_REQUESTED="tauri://close-requested",e.WINDOW_DESTROYED="tauri://destroyed",e.WINDOW_FOCUS="tauri://focus",e.WINDOW_BLUR="tauri://blur",e.WINDOW_SCALE_FACTOR_CHANGED="tauri://scale-change",e.WINDOW_THEME_CHANGED="tauri://theme-changed",e.WINDOW_CREATED="tauri://window-created",e.WEBVIEW_CREATED="tauri://webview-created",e.DRAG_ENTER="tauri://drag-enter",e.DRAG_OVER="tauri://drag-over",e.DRAG_DROP="tauri://drag-drop",e.DRAG_LEAVE="tauri://drag-leave"})(_||(_={}));async function E(e,t){await w("plugin:event|unlisten",{event:e,eventId:t})}async function C(e,t,o){var n;const s=(n=void 0)!==null&&n!==void 0?n:{kind:"Any"};return w("plugin:event|listen",{event:e,target:s,handler:y(t)}).then(r=>async()=>E(e,r))}const{invoke:i}=window.__TAURI__.core;let h=!1;async function v(){showLoading("Carregando casas...");try{const e=await i("houses",{});return a("Casas carregadas com sucesso.","success"),JSON.parse(e)}catch(e){return a("Erro ao obter as casas: "+e.message,"danger"),[]}finally{g()}}C("progress",e=>{setProgress(e.payload)});let l=[];window.get_bicho_data=async function(e=void 0){let t,o;const n=document.getElementById("house-selector");e?(t=e.innerHTML,o=e.value):(t=n.options[n.selectedIndex].innerHTML,o=n.value);try{if(o==="invalid"||l.includes(o)){a("Casa de aposta inválida","danger");return}l.push(o);const s=document.getElementById("all-time-switch").checked,r=document.getElementById("last-updated").innerHTML,c=N(r);let d=D(c);(d>1600||s)&&(d=1600),showLoading(`Carregando dados da casa ${t}...`),a("Dados da casa carregados com sucesso.","success"),window.get_table_info()}catch(s){a(`Erro ao obter dados da casa: ${s.message}`,"danger")}finally{l=l.filter(s=>s!==o),g()}};window.get_table_info=async function(){showLoading("Carregando informações da tabela...");try{const e=document.getElementById("house-selector"),t=e.options[e.selectedIndex].innerHTML;if(t==="invalid")return;const o=JSON.parse(await i("get_database_info",{houseName:t}));document.querySelector("header > div:nth-child(1) > span").innerHTML=o.total_rows,document.querySelector("header > div:nth-child(2) > span").innerHTML=I(o.date)||"O banco de dados está vazio",await get_groups(t),await u(t),a("Informações da tabela carregadas com sucesso.","success")}catch(e){a("Erro ao obter informações da tabela: "+e.message,"danger")}finally{g()}};window.addEventListener("DOMContentLoaded",()=>{let e=document.querySelector("#house-selector");v().then(t=>{t.forEach(o=>{const n=document.createElement("option");n.value=o.value,n.innerHTML=o.name,e.appendChild(n)})})});window.export_csv=async function(){const e=document.getElementById("house-selector"),t=e.options[e.selectedIndex],o=t.innerHTML;if(t.value==="invalid"){a("Casa de aposta inválida","danger");return}try{const n=await b({defaultPath:`${o}.csv`,filters:[{name:"CSV Files",extensions:["csv"]}]});n?(await i("export_csv",{houseName:o,filePath:n}),a(`Arquivo salvo em: ${n}`,"success")):(a("O usuário cancelou o diálogo.","danger"),console.log(""))}catch(n){a("Erro ao salvar arquivo: "+n.message,"danger")}};window.get_hours=async function(e){try{return await i("get_hours",{houseName:e})}catch(t){return a("Erro ao obter horários: "+t.message,"danger"),[]}};window.get_places=async function(e){try{return await i("get_places",{houseName:e})}catch(t){return a("Erro ao obter prêmios: "+t.message,"danger"),[]}};window.add_group=async function(e,t){try{await i("add_group",{houseName:e,data:t}),await window.get_groups(e),u(e),a("Grupo adicionado com sucesso.","success")}catch(o){a("Erro ao adicionar grupo: "+o.message,"danger")}};window.get_groups=async function(e){try{const t=JSON.parse(await i("get_group",{houseName:e}));return x(t),t}catch(t){return a("Erro ao obter grupos: "+t.message,"danger"),[]}};window.update_group=async function(e,t){try{await i("edit_group",{houseName:e,data:t}),await window.get_groups(e),u(e),a("Grupo atualizado com sucesso.","success")}catch(o){throw a("Erro ao atualizar grupo: "+o.message,"danger"),o}};window.delete_group=async function(e){const t=document.getElementById("house-selector"),o=t.options[t.selectedIndex].innerHTML;try{await i("delete_group",{houseName:o,id:parseInt(e)}),await window.get_groups(o),u(o),a("Grupo deletado com sucesso.","success")}catch(n){a("Erro ao excluir grupo: "+n.message,"danger")}};async function u(e){try{const t=await i("get_loss_sequence",{houseName:e});L(t)}catch(t){a("Erro ao obter sequência de derrota: "+t.message,"danger")}}function L(e){const o=document.querySelector("#recomendationTable tbody");o.innerHTML="";const n=e.sort((s,r)=>r.loss_sequence-s.loss_sequence);for(const s of n){const r=document.createElement("tr"),c=s.loss_sequence>8?"green-bg":"red-bg",d=document.createElement("td");d.textContent=s.loss_sequence,d.classList.add(c),r.appendChild(d);const m=document.createElement("td");m.textContent=s.hour,m.classList.add(c),r.appendChild(m);const p=document.createElement("td");p.textContent=s.place,p.classList.add(c),r.appendChild(p);const f=document.createElement("td");f.textContent=s.group,f.classList.add(c),r.appendChild(f),o.appendChild(r)}}function D(e){const t=new Date(e*1e3),n=new Date-t;return Math.floor(n/(1e3*60*60*24))}function I(e){const t=new Date(e*1e3),o=String(t.getDate()).padStart(2,"0"),n=String(t.getMonth()+1).padStart(2,"0"),s=t.getFullYear();return`${o}-${n}-${s}`}function N(e){const[t,o,n]=e.split("-"),s=new Date(n,o-1,t);return Math.floor(s.getTime()/1e3)}function x(e){const t=document.querySelector("#groupTable tbody");t.innerHTML="";for(const o of e){const n=document.createElement("tr"),s=document.createElement("td");s.textContent=o.hour,n.appendChild(s);const r=document.createElement("td");r.textContent=o.place,n.appendChild(r);const c=document.createElement("td");c.textContent=o.group.join(", "),n.appendChild(c);const d=document.createElement("td");d.innerHTML=`
      <button class="btn btn-sm btn-warning" id="${o.id}" onclick="edit_group(this)">Editar</button>
      <button class="btn btn-sm btn-danger" id="${o.id}" onclick="window.delete_group(${o.id})">Excluir</button>
    `,n.appendChild(d),t.appendChild(n)}}window.showLoading=function(e="Carregando..."){const t=document.createElement("div");t.className="loading-box position-fixed top-0 start-0 w-100 h-100 d-flex justify-content-center align-items-center",t.innerHTML=`
    <div class="spinner-border text-primary" role="status" id="spinner">
      <span class="visually-hidden">${e}</span>
    </div>
    <div id="progressContainer" class="d-none">
      <div class="progress" style="width: 100%">
        <div id="progressBar" class="progress-bar progress-bar-striped bg-info" role="progressbar" style="width: 0%">0%</div>
      </div>
    </div>
    <span class="ms-3" id="loadingMessage">${e}</span>
  `,t.id="loadingBox",document.body.appendChild(t)};function g(){const e=document.getElementById("loadingBox");e&&e.remove(),h=!1}function a(e,t="info"){const o=document.createElement("div");o.className=`alert alert-${t} alert-dismissible fade show position-fixed top-0 end-0 m-3`,o.style.zIndex="1055",o.role="alert",o.innerHTML=`
    ${e}
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  `,document.body.appendChild(o),setTimeout(()=>{o.classList.remove("show"),o.addEventListener("transitionend",()=>o.remove())},5e3)}window.setProgress=function(e){const t=document.getElementById("spinner"),o=document.getElementById("progressContainer"),n=document.getElementById("progressBar");n&&(h||(t.classList.add("d-none"),o.classList.remove("d-none"),h=!0),e=Math.min(100,Math.max(0,e)),n.style.width=`${e}%`,n.textContent=`${e}%`,e===100&&g())};
